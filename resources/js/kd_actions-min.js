if(typeof Dom=="undefined"){Dom=YAHOO.util.Dom;}if(typeof Connect=="undefined"){Connect=YAHOO.util.Connect;}if(typeof KD=="undefined"){KD={};}if(typeof KD.utils=="undefined"){KD.utils={};}if(!KD.utils.Action){KD.utils.Action=new function(){this.byPassValidation=false;this.readOnlyColor="#E0E0E0";this.highlightColor="#FF0000";this.sdrErrors=null;this.validateJsonLoaded=function(){if(typeof YAHOO.lang.JSON==="undefined"){var eMsg="The YUI JSON library is required for locking.  Please add it to your display page.";alert(eMsg);throw (eMsg);}};this.removeElement=function(label,keepValue){var label_id=label;var isOptional=false;if(label.constructor==Array){label_id=label[0];isOptional=label[1];}var qLayer=KD.utils.Util.getElementObject(label_id);if(qLayer){if(!keepValue){var theEls=KD.utils.Util.getElementsByClassName("answerValue","*",qLayer);for(var i=0;i<theEls.length;i++){KD.utils.Action.setQuestionValue(KD.utils.Util.getIDPart(theEls[i].id),"$NULL$");}}qLayer.style.display="none";if(isOptional){KD.utils.Action.makeQuestionOptional(label_id);}}};this.insertElement=function(label){var label_id=label;var isRequired=false;if(label.constructor==Array){label_id=label[0];isRequired=label[1];}var qLayer=KD.utils.Util.getElementObject(label_id);if(qLayer){var visib=Dom.getStyle(qLayer,"visibility");if(visib&&visib.toUpperCase()=="HIDDEN"){qLayer.style.visibility="visible";}qLayer.style.display="block";if(isRequired){KD.utils.Action.makeQuestionRequired(label_id);}}};this.hideElementInPlace=function(label,keepValue){var label_id=label;var isOptional=false;if(label.constructor==Array){label_id=label[0];isOptional=label[1];}var qLayer=KD.utils.Util.getElementObject(label_id);if(qLayer){if(!keepValue){var theEls=KD.utils.Util.getElementsByClassName("answerValue","*",qLayer);for(var i=0;i<theEls.length;i++){KD.utils.Action.setQuestionValue(KD.utils.Util.getIDPart(theEls[i].id),"$NULL$");}}qLayer.style.visibility="hidden";if(isOptional){KD.utils.Action.makeQuestionOptional(label_id);}}};this.showElementInPlace=function(label){var label_id=label;var isRequired=false;if(label.constructor==Array){label_id=label[0];isRequired=label[1];}var qLayer=KD.utils.Util.getElementObject(label_id);if(qLayer){qLayer.style.visibility="inherit";if(isRequired){KD.utils.Action.makeQuestionRequired(label_id);}}};this.addListener=function(object,triggerEvent,fnctn){YAHOO.util.Event.addListener(object,triggerEvent,fnctn);};this.highlightField=function(answerField){var type=KD.utils.Util.getAnswerType(answerField);var answerFieldDiv=answerField.parentNode;KD.utils.Util.addClass(answerFieldDiv,"requiredField");KD.utils.Util.addClass(answerFieldDiv,"requiredField_"+type);var labelObj=KD.utils.Util.getQuestionLabel(KD.utils.Util.getLabelFromAnswerEl(answerField));if(labelObj){KD.utils.Util.addClass(labelObj,"requiredLabel");KD.utils.Util.addClass(labelObj,"requiredLabel_"+type);var origColor=labelObj.getAttribute("origStyleColor");if(origColor==null||origColor==""){labelObj.setAttribute("origStyleColor",(labelObj.style.color)?labelObj.style.color:"defaultColor");labelObj.style.color=KD.utils.Action.highlightColor;}}};this.resetRequiredField=function(answerField){var type=KD.utils.Util.getAnswerType(answerField);var answerFieldDiv=answerField.parentNode;KD.utils.Util.removeClass(answerFieldDiv,"requiredField");KD.utils.Util.removeClass(answerFieldDiv,"requiredField_"+type);var labelObj=KD.utils.Util.getQuestionLabel(KD.utils.Util.getLabelFromAnswerEl(answerField));if(labelObj){KD.utils.Util.removeClass(labelObj,"requiredLabel");KD.utils.Util.removeClass(labelObj,"requiredLabel_"+type);var origStyle=labelObj.getAttribute("origStyleColor");if(origStyle=="defaultColor"){origStyle="";}labelObj.style.color=origStyle;labelObj.removeAttribute("origStyleColor");}};this.getErrorValue=function(answerField){var errorVal=answerField.getAttribute("errorValue");if(errorVal==null||errorVal==""){var labelObj=KD.utils.Util.getQuestionLabel(KD.utils.Util.getLabelFromAnswerEl(answerField));if(labelObj!=null){errorVal=KD.utils.Util.getQuestionLabelValue(labelObj);if(errorVal==null||errorVal==""){errorVal=labelObj.getAttribute("label");}}}return errorVal;};this.mimicRadioClick=function(elementId,elIndex){var myRadioElements=document.getElementsByName(elementId);myRadioElements[elIndex].click();};this.watchFieldLength=function(el){var limit=el.getAttribute("maxlength");if(limit){limit=parseInt(limit);}else{return;}if(el.value&&el.value.length>limit){el.value=el.value.substring(0,limit);}};this.loadPreviousPage=function(){var valid=true;if(KD.utils.ClientManager.isAuthenticationRequired==="true"){KD.utils.Action.byPassValidation=true;KD.utils.ClientManager.checkSession();var response=KD.utils.ClientManager.sessionCheck;if(response.status!==200){var message=response.statusText;if(response.getResponseHeader!=null&&response.getResponseHeader["X-Error-Message"]!=null){message=response.getResponseHeader["X-Error-Message"];}KD.utils.ClientManager.registerInvalidSessionRequest("PREV_PAGE_REQUEST","","","");KD.utils.Action.handleHttpErrorCode(response.status,message);valid=false;}}if(!valid){for(var i=0;i<KD.utils.ClientManager.submitButtons.length;i++){KD.utils.Action.enableButton(KD.utils.ClientManager.submitButtons[i]);}KD.utils.ClientManager.isSubmitting=false;return;}document.pageQuestionsForm.action="PreviousPage";this.byPassValidation=true;document.pageQuestionsForm.submit();};this.validateForm=function(evt,form){var trigger=YAHOO.util.Event.getTarget(evt);var pageId=Dom.get("pageID").value;var valid=true;var clientAction,fn;if(!trigger.type||(trigger.type&&trigger.type.toUpperCase()!="BUTTON"&&trigger.type.toUpperCase()!="SUBMIT")){try{YAHOO.util.Event.stopEvent(evt);}catch(e){}KD.utils.ClientManager.isSubmitting=false;return false;}if(KD.utils.Action.byPassValidation){return true;}var actions=KD.utils.ClientManager.customEvents.getItem(pageId+"-beforeSubmit");if(actions&&actions.length>0){for(var k=0;k<actions.length;k++){clientAction=actions[k];fn=clientAction.action;
valid=fn.call(evt,evt,clientAction);if(valid==null){valid=true;}if(valid==false){try{YAHOO.util.Event.stopEvent(evt);}catch(e){}for(var i=0;i<KD.utils.ClientManager.submitButtons.length;i++){KD.utils.Action.enableButton(KD.utils.ClientManager.submitButtons[i]);}KD.utils.ClientManager.isSubmitting=false;return false;}}}valid=KD.utils.Action.validateFields(form.elements);if(valid){var submitActions=KD.utils.ClientManager.customEvents.getItem(pageId+"-submit");if(submitActions&&submitActions.length>0){for(var m=0;m<submitActions.length;m++){clientAction=submitActions[m];fn=clientAction.action;valid=fn.call(evt,evt,clientAction);if(valid==null){valid=true;}if(valid==false){break;}}}}if(valid){if(KD.utils.ClientManager.isAuthenticationRequired==="true"){KD.utils.ClientManager.checkSession();var response=KD.utils.ClientManager.sessionCheck;if(response.status!==200){var message=response.statusText;if(response.getResponseHeader!=null&&response.getResponseHeader["X-Error-Message"]!=null){message=response.getResponseHeader["X-Error-Message"];}KD.utils.ClientManager.registerInvalidSessionRequest("NEXT_PAGE_REQUEST","","","");KD.utils.Action.handleHttpErrorCode(response.status,message);valid=false;}}}if(!valid){try{YAHOO.util.Event.stopEvent(evt);}catch(e){}for(i=0;i<KD.utils.ClientManager.submitButtons.length;i++){KD.utils.Action.enableButton(KD.utils.ClientManager.submitButtons[i]);}KD.utils.ClientManager.isSubmitting=false;}if(valid&&trigger.type&&trigger.type.toUpperCase()=="BUTTON"){KD.utils.Action._clearTransientFields(form);form.submit();}return valid;};this.validateFields=function(fieldsArray){var valid=true;var nextElement=null;var firstErrorElement=null;var requiredFieldList="";var formatFieldList="";var requiredWarning=KD.utils.ClientManager.requiredWarningStr;var formatWarning=KD.utils.ClientManager.validFormatWarningStr;var maxCharsOnSubmit=KD.utils.ClientManager.maxCharsOnSubmit;var characterCount=0;var disabledFields=new Array();var checkedFields=new Array();var checkboxFields={};var fieldPrefix="<li>";var fieldSuffix="</li>";for(var f=0;f<fieldsArray.length;f++){var cb=fieldsArray[f].type&&fieldsArray[f].type.toLowerCase()=="checkbox";if(cb){var cbChecked=fieldsArray[f].checked;var reqAttr=fieldsArray[f].getAttribute("required");if(reqAttr&&reqAttr.toLowerCase()=="true"){var cbParentId=KD.utils.Util.getCheckboxParentId(fieldsArray[f]);if(cbParentId){var cbParentExists=typeof checkboxFields[cbParentId]!=="undefined";if(!cbParentExists||(cbParentExists&&checkboxFields[cbParentId]==false)){checkboxFields[cbParentId]=fieldsArray[f].checked;}}}}}for(var i=0;i<fieldsArray.length;i++){nextElement=fieldsArray[i];if(nextElement.disabled==true&&nextElement.type&&nextElement.type.toUpperCase()!="SUBMIT"&&nextElement.type.toUpperCase()!="BUTTON"){disabledFields.push(nextElement);}if(KD.utils.Action._isTransient(nextElement)){continue;}var foundValue=false;if(nextElement.type=="radio"||nextElement.type=="checkbox"){if(nextElement.checked){characterCount+=nextElement.value.length;foundValue=true;}}else{if(nextElement.type!="button"&&nextElement.value.length>0){characterCount+=nextElement.value.length;foundValue=true;}}if(foundValue){characterCount+=nextElement.name.length+1;}if(nextElement.getAttribute("required")=="true"&&checkedFields[nextElement.name]!="true"){checkedFields[nextElement.name]="true";if(nextElement.tagName.toLowerCase()=="select"){if(nextElement.options.length==0||nextElement.selectedIndex==null||nextElement.value==""){requiredFieldList+=fieldPrefix+KD.utils.Action.getErrorValue(nextElement)+fieldSuffix;if(firstErrorElement==null){firstErrorElement=nextElement;}KD.utils.Action.highlightField(nextElement);valid=false;}else{KD.utils.Action.resetRequiredField(nextElement);}}else{if(nextElement.type.toLowerCase()=="radio"){var radioGroup=document.getElementsByName(nextElement.name);var isChecked=false;for(var j=0;j<radioGroup.length;j++){if(radioGroup[j].checked==true){isChecked=true;}}if(isChecked==false){if(firstErrorElement==null){firstErrorElement=radioGroup[0];}KD.utils.Action.highlightField(radioGroup[0]);requiredFieldList+=fieldPrefix+KD.utils.Action.getErrorValue(radioGroup[0])+fieldSuffix;valid=false;}else{KD.utils.Action.resetRequiredField(radioGroup[0]);}}else{if(nextElement.type.toLowerCase()=="checkbox"){cbParentId=KD.utils.Util.getCheckboxParentId(nextElement);if(cbParentId&&typeof checkedFields[cbParentId]=="undefined"){if(checkboxFields[cbParentId]!=true){if(firstErrorElement==null){firstErrorElement=nextElement;}KD.utils.Action.highlightField(nextElement);requiredFieldList+=fieldPrefix+KD.utils.Action.getErrorValue(nextElement)+fieldSuffix;valid=false;}checkedFields[cbParentId]="true";}if(cbParentId&&checkboxFields[cbParentId]==true){KD.utils.Action.resetRequiredField(nextElement);}}else{if((!nextElement.value||nextElement.value.length<1)&&nextElement.type.toLowerCase()!="checkbox"){if(firstErrorElement==null){firstErrorElement=nextElement;}var isDate=false;var myParent=nextElement.parentNode;for(var iIdx=0;iIdx<myParent.children.length;iIdx++){if(myParent.children[iIdx].id!=undefined&&myParent.children[iIdx].id.indexOf("year_")!=-1){KD.utils.Action.highlightField(myParent.children[iIdx]);isDate=true;break;}}if(!isDate){KD.utils.Action.highlightField(nextElement);}requiredFieldList+=fieldPrefix+KD.utils.Action.getErrorValue(nextElement)+fieldSuffix;valid=false;continue;}else{KD.utils.Action.resetRequiredField(nextElement);}}}}}if(nextElement.value.length>0&&nextElement.getAttribute("validationFormat")){var expStr=nextElement.getAttribute("validationFormat");var exp=new RegExp(expStr);if(exp.test(nextElement.value)==false){KD.utils.Action.highlightField(nextElement);var validationText=nextElement.getAttribute("validationText");if(validationText){formatFieldList+=fieldPrefix+validationText+fieldSuffix;}valid=false;}else{KD.utils.Action.resetRequiredField(nextElement);}}else{if((nextElement.value.length==0&&nextElement.getAttribute("required")!="true")&&nextElement.getAttribute("validationFormat")){KD.utils.Action.resetRequiredField(nextElement);
}}if(nextElement.name&&nextElement.name.indexOf("SRVQSTN_")!=-1){var isDateField=KD.utils.Util.isDate(nextElement);if(isDateField){var validDate=KD.utils.Action.validateDateField(nextElement);if(!validDate){if(firstErrorElement==null){firstErrorElement=nextElement;}KD.utils.Action.highlightField(nextElement);var label="";var labelObj=KD.utils.Util.getQuestionLabel(KD.utils.Util.getLabelFromAnswerEl(nextElement));if(labelObj&&labelObj.getAttribute("label")){label=labelObj.getAttribute("label");}formatFieldList+=fieldPrefix+label+" is not a valid date"+fieldSuffix;valid=false;}else{KD.utils.Action.resetRequiredField(nextElement);}}}}if(!valid){var errorStr="";if(requiredFieldList){errorStr+="<div class='warningTitle'><h3>"+requiredWarning+"</h3><ul>"+requiredFieldList+"</ul></div>";}if(formatFieldList){errorStr+="<div class='warningTitle'><h3>"+formatWarning+"</h3><ul>"+formatFieldList+"</ul></div>";}KD.utils.ClientManager.alertPanel({header:"Form Validation Errors",body:errorStr,element:firstErrorElement});return false;}if(characterCount>maxCharsOnSubmit){KD.utils.ClientManager.alertPanel({header:"Form Error",body:KD.utils.ClientManager.tooManyCharactersForSubmitStr,element:null});return false;}for(j=0;j<disabledFields.length;j++){if(disabledFields[j].id.indexOf("SRVQSTN_")!=-1){disabledFields[j].disabled=false;}}return true;};this.validateDateField=function(el){var elValue,dtParts,yr,mn,dy,d1,h,m,s;if(el&&el.value&&el.value!=null&&el.value!=""){elValue=el.value;dtParts=KD.utils.Util.parseDtString(elValue);yr=dtParts[0];mn=dtParts[1]-1;dy=dtParts[2];if(dtParts.length>3){h=dtParts[3];m=dtParts[4];s=dtParts[5];d1=new Date(yr,mn,dy,h,m,s,0);if(d1.getFullYear()!=yr||d1.getMonth()!=mn||d1.getDate()!=dy||d1.getHours()!=h||d1.getMinutes()!=m||d1.getSeconds()!=s){return false;}}else{d1=new Date(yr,mn,dy);if(d1.getFullYear()!=yr||d1.getMonth()!=mn||d1.getDate()!=dy){return false;}}}return true;};this._clearTransientFields=function(form){var i,els;form=Dom.get(form);els=form.elements;for(i=0;i<els.length;i+=1){if(KD.utils.Action._isTransient(els[i])){els[i].value="";}}};this._isTransient=function(el){var attValue,attName="transient",testValue="transient";attValue=el.getAttribute(attName);return(attValue&&attValue.toLowerCase()===testValue);};this.setQuestionValue=function(label_id,value){return KD.utils.Util.setQuestionValue(label_id,value);};this.getQuestionValue=function(label_id){return KD.utils.Util.getQuestionValue(label_id);};this.setReadOnly=function(label_id){var elements=new Array();var element=KD.utils.Util.getElementObject(label_id);if(KD.utils.Util.hasClass(element,"templateSection")){element=KD.utils.Util.getElementObject(label_id,"SECTION_");if(element){elements=element.children;for(var i=0;i<elements.length;i++){this.setReadOnly(KD.utils.Util.getIDPart(elements[i].id));}return;}}else{if(KD.utils.Util.hasClass(element,"questionLayer")){element=KD.utils.Util.getElementObject(label_id,"QANSWER_");if(element){elements=element.children;var els=new Array();for(i=0;i<elements.length;i++){if(KD.utils.Util.hasClass(elements[i],"answerCheckbox")){els[i]=elements[i].children[0];}else{els[i]=elements[i];}}}}}if(els){if(!KD.utils.Util.isArray(els)){els=[els];}for(i=0;i<els.length;i++){var qst=els[i];if(qst.tagName&&(qst.tagName.toUpperCase()=="INPUT"||qst.tagName.toUpperCase()=="TEXTAREA")){if(qst.type&&(qst.type.toUpperCase()=="RADIO"||qst.type.toUpperCase()=="CHECKBOX")||qst.type.toUpperCase()=="SUBMIT"||qst.type.toUpperCase()=="BUTTON"){qst.disabled=true;}else{qst.setAttribute("readOnly","readOnly");qst.style.backgroundColor=KD.utils.Action.readOnlyColor;if(KD.utils.Util.hasClass(qst,"dateYear")||KD.utils.Util.hasClass(qst,"dtYear")){var calParent=qst.parentNode;var calPicker=calParent.getElementsByTagName("img")[0];if(calPicker&&calPicker.tagName&&calPicker.tagName.toUpperCase()=="IMG"){calPicker.style.display="none";}}}}else{if(qst.tagName&&qst.tagName.toUpperCase()=="SELECT"){qst.disabled=true;}}}}else{if((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))||(KD.utils.Util.getElementObject(label_id,"DYNAMIC_TEXT_"))||(KD.utils.Util.getElementObject(label_id,"IMAGE_"))){var nodeRef=((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))||(KD.utils.Util.getElementObject(label_id,"DYNAMIC_TEXT_"))||(KD.utils.Util.getElementObject(label_id,"IMAGE_")));KD.utils.Action._iterActionCall.call(this,nodeRef,KD.utils.Action.setReadOnly);}else{alert("function setReadOnly - Unable to locate the Object for: "+label_id);}}};this.setReadWrite=function(label_id){var elements=new Array();var element=KD.utils.Util.getElementObject(label_id);if(KD.utils.Util.hasClass(element,"templateSection")){element=KD.utils.Util.getElementObject(label_id,"SECTION_");if(element){elements=element.children;for(var i=0;i<elements.length;i++){this.setReadWrite(KD.utils.Util.getIDPart(elements[i].id));}return;}}else{if(KD.utils.Util.hasClass(element,"questionLayer")){element=KD.utils.Util.getElementObject(label_id,"QANSWER_");if(element){elements=element.children;var els=new Array();for(i=0;i<elements.length;i++){if(KD.utils.Util.hasClass(elements[i],"answerCheckbox")){els[i]=elements[i].children[0];}else{els[i]=elements[i];}}}}}if(els){if(!KD.utils.Util.isArray(els)){els=[els];}for(i=0;i<els.length;i++){var qst=els[i];if(qst.tagName&&(qst.tagName.toUpperCase()=="INPUT"||qst.tagName.toUpperCase()=="TEXTAREA")&&!qst.getAttribute("fileTypesAllowed")){if(qst.type&&(qst.type.toUpperCase()=="RADIO"||qst.type.toUpperCase()=="CHECKBOX"||qst.type.toUpperCase()=="SUBMIT"||qst.type.toUpperCase()=="BUTTON")){qst.disabled=false;}else{qst.removeAttribute("readOnly");qst.style.backgroundColor="";if(KD.utils.Util.hasClass(qst,"dateYear")||KD.utils.Util.hasClass(qst,"dtYear")){var calParent=qst.parentNode;var calPicker=calParent.getElementsByTagName("img")[0];if(calPicker&&calPicker.tagName&&calPicker.tagName.toUpperCase()=="IMG"){calPicker.style.display="";
}}if(KD.utils.Util.hasClass(qst,"dateHidden")||KD.utils.Util.hasClass(qst,"dateLocal")||KD.utils.Util.hasClass(qst,"dtHidden")||KD.utils.Util.hasClass(qst,"dtLocal")){qst.setAttribute("readOnly","readOnly");qst.style.backgroundColor=KD.utils.Action.readOnlyColor;}}}else{if(qst.tagName&&qst.tagName.toUpperCase()=="SELECT"){qst.disabled=false;}}}}else{if((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))||(KD.utils.Util.getElementObject(label_id,"DYNAMIC_TEXT_"))||(KD.utils.Util.getElementObject(label_id,"IMAGE_"))){var nodeRef=((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))||(KD.utils.Util.getElementObject(label_id,"DYNAMIC_TEXT_"))||(KD.utils.Util.getElementObject(label_id,"IMAGE_")));KD.utils.Action._iterActionCall.call(this,nodeRef,KD.utils.Action.setReadWrite);}else{alert("function setReadWrite - Unable to locate the Object for: "+label_id);}}};this.disableButton=function(label_id){var div=KD.utils.Util.getButtonObject(label_id);if(div&&div!=""){var input=div.getElementsByTagName("input");input[0].disabled=true;}else{alert("function disableButton - Unable to locate the Object for: "+label_id);}};this.enableButton=function(label_id){var div=KD.utils.Util.getButtonObject(label_id);if(div&&div!=""){var input=div.getElementsByTagName("input");input[0].disabled=false;}else{alert("function enableButton - Unable to locate the Object for: "+label_id);}};this.disableSubmitButtons=function(e){for(var i=0;i<KD.utils.ClientManager.submitButtons.length;i+=1){KD.utils.Action.disableButton(KD.utils.ClientManager.submitButtons[i]);}};this.enableSubmitButtons=function(e){for(var i=0;i<KD.utils.ClientManager.submitButtons.length;i+=1){KD.utils.Action.enableButton(KD.utils.ClientManager.submitButtons[i]);}};this.checkPattern=function(obj){var qstn=KD.utils.Util.getElementFromObject(obj);var valFormat=qstn.getAttribute("validationFormat");if(valFormat&&valFormat!=""){var expStr=qstn.getAttribute("validationFormat");var exp=new RegExp(expStr);var qstnVal=KD.utils.Util.trimString(qstn.value);if(qstnVal!=null&&qstnVal.length>0&&exp.test(qstnVal)==false){KD.utils.Action.highlightField(qstn);var validationText=qstn.getAttribute("validationText");KD.utils.ClientManager.alertPanel({header:"Invalid Formatted Field",body:validationText,element:null});KD.utils.Action._enableButtonEvents();return;}if((qstnVal==null||qstnVal=="")||exp.test(qstnVal)==true){KD.utils.Action.resetRequiredField(qstn);KD.utils.Action._enableButtonEvents();var patternError=qstn.getAttribute("patternError");if(patternError){qstn.removeAttribute("patternError");}}}};this.makeQuestionRequired=function(label_id){var els=KD.utils.Util.getQuestionInput(label_id);if(els){if(!KD.utils.Util.isArray(els)){els=[els];}for(var i=0;i<els.length;i++){var cls=els[i].className;if(cls!=null&&(cls.indexOf("dateYear")!=-1||cls.indexOf("dateMonth")!=-1||cls.indexOf("dateDay")!=-1)||cls.indexOf("dateLocal")!=-1){continue;}if(cls!=null&&(cls.indexOf("dtYear")!=-1||cls.indexOf("dtMonth")!=-1||cls.indexOf("dtDay")!=-1||cls.indexOf("dtHour")!=-1||cls.indexOf("dtMin")!=-1||cls.indexOf("dtAMPM")!=-1||cls.indexOf("dtLocal")!=-1)){continue;}els[i].setAttribute("required","true");var errorValue=els[i].getAttribute("errorValue");if(!errorValue||errorValue==""){els[i].setAttribute("errorValue",KD.utils.Util.getLabelValueFromAnswerEl(els[i]));}}KD.utils.ClientManager.setPreRequire(label_id);}else{if((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))){var nodeRef=((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_")));KD.utils.Action._iterActionCall.call(this,nodeRef,KD.utils.Action.makeQuestionRequired);}}};this.makeQuestionOptional=function(label_id){var els=KD.utils.Util.getQuestionInput(label_id);if(els){if(!KD.utils.Util.isArray(els)){els=[els];}for(var i=0;i<els.length;i++){els[i].removeAttribute("required");}KD.utils.Action.resetRequiredField(els[0]);KD.utils.ClientManager.clearPreRequire(label_id);}else{if((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_"))){var nodeRef=((KD.utils.Util.getElementObject(label_id,"PAGE_"))||(KD.utils.Util.getElementObject(label_id,"SECTION_")));KD.utils.Action._iterActionCall.call(this,nodeRef,KD.utils.Action.makeQuestionOptional);}}};this.applyValueActions=function(el,clientAction){if(!clientAction||!clientAction.action||!el||!el.type){return;}var fire=false;if(el.type.toUpperCase()=="RADIO"&&el.checked){fire=true;}else{if(el.type.toUpperCase()=="CHECKBOX"&&el.checked){fire=true;}else{if((el.type.toUpperCase()=="TEXT"||el.tagName.toUpperCase()=="SELECT"||el.tagName.toUpperCase()=="TEXTAREA")&&el.value&&el.value!=""){fire=true;}}}if(fire){clientAction.action.apply(KD.utils.Action,[{target:el,type:clientAction.jsEvent},clientAction]);}};this.showResultsAsAdvancedTable=function(recordXMLArray,questions,source){var cols=[],visibleCols=[];for(var question in questions[0]){questions[0][question]["qId"]=question;cols.push(questions[0][question]);}cols.sort(function(a,b){return a["sort_order"]-b["sort_order"];});for(var col in cols){if(cols[col]["visible"]=="Yes"||cols[col]["visible"]==null||cols[col]["visible"]==""){visibleCols.push(cols[col]);}}var theTable=document.createElement("table");var theHead=document.createElement("thead");var theBody=document.createElement("tbody");var oddEven="odd";if(recordXMLArray&&recordXMLArray.length>0){var headerRow=document.createElement("tr");var headerFields=recordXMLArray[0].getElementsByTagName("field");for(var col in visibleCols){var qId=visibleCols[col]["qId"];var thisCell=document.createElement("th");var colLabel=KD.utils.Action._getAdvancedColumnLabel(visibleCols[col],source);thisCell.appendChild(document.createTextNode(colLabel));headerRow.appendChild(thisCell);}headerRow.id="headerRow";theHead.appendChild(headerRow);for(var i=0;
i<recordXMLArray.length;i++){var thisRow=document.createElement("tr");thisRow.id="row_"+i;thisRow.className="record row_"+oddEven;var fields=recordXMLArray[i].getElementsByTagName("field");var values={};if(source=="bridge"){for(var fieldIndex=0;fieldIndex<fields.length;fieldIndex++){if(fields[fieldIndex].textContent){value=fields[fieldIndex].textContent;}else{value=fields[fieldIndex].text;}values[fields[fieldIndex].getAttribute("id")]=value||"";}}for(col in visibleCols){var qId=visibleCols[col]["qId"];var map=visibleCols[col][qId];var value;if(source=="bridge"){value=map;var attributePattern=/<%=\s*attribute\["(.+?)"\]\s*%>/;var match=attributePattern.exec(value);while(match!=null){value=value.replace(match[0],values[match[1]]);match=attributePattern.exec(value);}}else{value=KD.utils.Action._getAdvancedColumnValue(map,fields);}var thisCell=document.createElement("td");thisCell.appendChild(document.createTextNode(value));thisCell.id="r_"+i+"_c_"+col;thisRow.appendChild(thisCell);}theBody.appendChild(thisRow);if(oddEven=="odd"){oddEven="even";}else{oddEven="odd";}}}theTable.appendChild(theHead);theTable.appendChild(theBody);return theTable;};this._getAdvancedColumnLabel=function(col,source){var label=col["table_label"];if(label==null||KD.utils.Util.trimString(label)==""){var questionId=col["qId"];var fieldMap=col[questionId];if(source=="bridge"){var attributePattern=/<%=\s*attribute\["(.+?)"\]\s*%>/;var match=attributePattern.exec(fieldMap);if(match){label=match[1];}}else{var flds=fieldMap.split("</FLD>");for(var i=0;i<flds.length;i++){if(flds[i].indexOf("<FLD>")>-1){label=(flds[i].split(";")[0]).substring(flds[i].indexOf("<FLD>")+5);break;}}}}return label;};this._getAdvancedColumnValue=function(fieldMap,fields){var fieldName="",value="",fieldValue="",flds=fieldMap.split("</FLD>");for(var i=0;i<flds.length;i++){if(flds[i].indexOf("<FLD>")==-1){value+=flds[i];}else{var segs=flds[i].split("<FLD>");if(segs.length>1){value+=segs[0];}fieldName=(flds[i].split(";")[0]).substring(flds[i].indexOf("<FLD>")+5);for(var j=0;j<fields.length;j++){if(fields[j].getAttribute("id")==fieldName){if(fields[j].childNodes.length>0){fieldValue=fields[j].firstChild.nodeValue;}else{fieldValue="";}}}value+=fieldValue;}}value=value.replace(/%0A/gi,"\n");value=value.replace(/%0D/gi,"\n");return KD.utils.Util.trimString(value);};this.showResultsAsTable=function(recordXMLArray,tableId,tableClass){var theTable=document.createElement("table");var thisCell;if(tableId){theTable.setAttribute("id",tableId);}if(tableClass){theTable.className=tableClass;}var theBody=document.createElement("tbody");var oddEven="odd";if(recordXMLArray&&recordXMLArray.length>0){var headerRow=document.createElement("tr");var headerFields=recordXMLArray[0].getElementsByTagName("field");for(var a=0;a<headerFields.length;a++){thisCell=document.createElement("th");thisCell.appendChild(document.createTextNode(headerFields[a].getAttribute("id")));headerRow.appendChild(thisCell);}headerRow.id="headerRow";theBody.appendChild(headerRow);for(var i=0;i<recordXMLArray.length;i++){var thisRow=document.createElement("tr");thisRow.id="row_"+i;thisRow.className="record row_"+oddEven;var fields=recordXMLArray[i].getElementsByTagName("field");for(var k=0;k<fields.length;k++){thisCell=document.createElement("td");var fieldValue="";if(fields[k].firstChild){fieldValue=fields[k].firstChild.nodeValue;}thisCell.appendChild(document.createTextNode(fieldValue));thisCell.id="r_"+i+"_c_"+k;thisRow.appendChild(thisCell);}theBody.appendChild(thisRow);if(oddEven=="odd"){oddEven="even";}else{oddEven="odd";}}}theTable.appendChild(theBody);return theTable;};this.displayError=function(message,response){KD.utils.ClientManager.alertPanel({header:"Error",body:"<b>The following error occurred:</b> "+message,element:null});};this.makeAsyncBridgeRequest=function(source,sourceId,parameterString,callback){source=encodeURIComponent(source);sourceId=encodeURIComponent(sourceId);var now=new Date();var path="BridgeDataRequest"+"?formId="+KD.utils.ClientManager.templateId+"&source="+source+"&bridgedResourceId="+sourceId+parameterString+"&noCache="+now.getTime();var failureCallback=callback.failure;var failureCallbackWrapper=function(response){if(response.status==401){KD.utils.ClientManager.registerUnauthorizedSessionRequest(sourceId,"GET",path,{success:callback.success,failure:failureCallbackWrapper,argument:callback.argument});if(document.getElementById("simpleLogin")==null){KD.utils.Action.handleHttpErrorCode(response.status,"Not authorized.");}}else{failureCallback(response);}};callback["failure"]=failureCallbackWrapper;Connect.asyncRequest("GET",path,callback);};this.makeAsyncRequest=function(requestName,dataRequestId,callback,paramString,format,useGetList,synchronous){if(KD.utils.Action.sdrErrors==null){KD.utils.Action.sdrErrors=new KD.utils.Hash();}if(paramString&&paramString!=""&&paramString.indexOf("&")!=0){paramString="&"+paramString;}dataRequestId=encodeURIComponent(dataRequestId);requestName=encodeURIComponent(requestName);var sessionId=encodeURIComponent(KD.utils.ClientManager.sessionId);var now=new Date();var entryParam="";if(useGetList==true){entryParam="&useGetList=true";}var path="SimpleDataRequest?requestName="+requestName+"&dataRequestId="+dataRequestId+"&sessionId="+sessionId+"&format="+format+paramString+entryParam+"&noCache="+now.getTime();KD.utils.ClientManager.registerInvalidSessionRequest(dataRequestId,"GET",path,callback);if(callback.includeLoadingImage){var elId=null,el=null;if(KD.utils.Util.isArray(callback.argument[0])){elId=callback.argument[0][0];}else{elId=callback.argument[0];}if(elId){el=Dom.get(elId);}if(el){el.innerHTML='<img src="./resources/catalogIcons/ajax-loader.gif" class="ajax_load_img">';}}var isActive=KD.utils.ClientManager.isActiveConnection(dataRequestId);var isValid=true;if(isActive){var prevCall=KD.utils.ClientManager.getConnection(dataRequestId);if(prevCall[1]==paramString){isValid=false;}else{try{prevCall[0].conn.abort(prevCall,callback,false);}catch(error){}}}if(isValid){var fnctnError=callback.error;
callback.failure=function(response){var message=response.statusText;if(response.getResponseHeader!=null&&response.getResponseHeader["X-Error-Message"]!=null){message=response.getResponseHeader["X-Error-Message"];}var connectionStatus=response.getResponseHeader["Connection"];if(!KD.utils.Action.sdrErrors.getItem(response.status)||!connectionStatus||connectionStatus.indexOf("close")!=-1){KD.utils.Action.sdrErrors.setItem(response.status,message);if(!connectionStatus||connectionStatus.indexOf("close")!=-1){KD.utils.ClientManager.checkSession();var sessionResponse=KD.utils.ClientManager.sessionCheck;if(sessionResponse.status!==200){if(callback.includeLoadingImage&&el){el.innerHTML="";}var sessionMessage=sessionResponse.statusText;if(sessionResponse.getResponseHeader!=null&&sessionResponse.getResponseHeader["X-Error-Message"]!=null){sessionMessage=sessionResponse.getResponseHeader["X-Error-Message"];}KD.utils.Action.handleHttpErrorCode(sessionResponse.status,sessionMessage);}}else{KD.utils.Action.handleHttpErrorCode(response.status,sessionMessage);}return;}if(fnctnError){fnctnError(response);}};var fnctnSuccess=callback.success;callback.success=function(response){KD.utils.Action.sdrErrors=new KD.utils.Hash();KD.utils.ClientManager.clearInvalidSessionRequest();fnctnSuccess(response);};if(synchronous===true){KD.utils.Action._makeSyncRequest(path,callback);}else{var params=KD.utils.ClientManager.getInvalidSessionRequest();if(params[1]!==null&&params[2]!==null&&params[3]!==null){Connect.setDefaultPostHeader(false);Connect.initHeader("Cache-Control","no-cache, no-store");Connect.initHeader("Pragma","no-cache");Connect.initHeader("Expires","-1");Connect.asyncRequest(params[1],params[2],params[3]);}}}};this._makeSyncRequest=function(path,callback){var oXhr,xhr,xhrTimeout,oResponse;oXhr=KD.utils.Action._createSyncXhr();if(oXhr){xhr=oXhr.xhr;xhr.open("GET",path,false);xhrTimeout=setTimeout(function(){xhr.abort();},callback.argument[0].timeout||30000);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Cache-Control","no-cache, no-store");xhr.setRequestHeader("Pragma","no-cache");xhr.setRequestHeader("Expires","-1");try{xhr.send(null);}catch(e){callback.failure({status:0,statusText:"Communication Failure",argument:callback.argument});}if(xhr.readyState==4){clearTimeout(xhrTimeout);oResponse=KD.utils.Action._buildSyncResponse(xhr,callback.argument);if(xhr.status!=200){callback.failure(oResponse);return;}if(callback.success===KD.utils.Action._setFieldsCallback){callback.success(oResponse);}else{callback.success(oResponse);}}}else{alert("Your browser does not support AJAX requests.");}};this.getMultipleRequestRecords=function(o){var records,xml,parser,text;try{records=o.responseXML.getElementsByTagName("record");if(records.length==0){if(o.responseXML!=null&&o.responseXML.xml!=null&&o.responseXML.xml.length==0){throw"rebuild ie xml";}}}catch(e){if(o.responseText&&o.responseText.length>0){text=o.responseText;text=text.replace(/[^\u0009-\u000d\u0020-\uffff]*/gi,"");if(window.DOMParser){parser=new DOMParser();xml=parser.parseFromString(text,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(text);}try{records=xml.getElementsByTagName("record");}catch(e2){}}}return records;};this.getSingleRequestRecord=function(o){try{return o.responseXML.getElementsByTagName("record")[0];}catch(e){}};this.getRequestName=function(o){try{return o.responseXML.getElementsByTagName("requestName")[0].firstChild.nodeValue;}catch(e){}};this.openDatePicker=function(evt,id){new YAHOO.KD.widget.CalendarPicker(evt,id,"d");};this.openDateTimePicker=function(evt,id){new YAHOO.KD.widget.CalendarPicker(evt,id,"dt");};this.dateSelected=function(evt,dateArr,params){var datePart,nullDate=false,qstnId=params[0];if(dateArr&&dateArr[0]&&dateArr[0][0]){datePart=dateArr[0][0];}else{datePart=dateArr;}if(datePart==null){nullDate=true;}var hour=Dom.get("hour_"+qstnId);if(hour){KD.utils.Action.setDateTimeFields(qstnId,datePart,nullDate);}else{KD.utils.Action.setDateFields(qstnId,datePart,nullDate);}};this.updateDate=function(el){var qstnId=KD.utils.Util.getIDPart(el.id);var qstn=KD.utils.Util.getElementObject(qstnId,"SRVQSTN_");var yr=Dom.get("year_"+qstnId).value;var month=Dom.get("month_"+qstnId).value;var day=Dom.get("day_"+qstnId).value;if(el.value==null||el.value==""){KD.utils.Action.setDateFields(qstnId,null,true);return;}if(yr&&month&&month!=""&&day&&day!=""){KD.utils.Action.setDateFields(qstnId,[yr,month,day]);}};this.updateDateTime=function(el){var qstnId=KD.utils.Util.getIDPart(el.id);var qstn=KD.utils.Util.getElementObject(qstnId,"SRVQSTN_");var yr=Dom.get("year_"+qstnId).value;var month=Dom.get("month_"+qstnId).value;var day=Dom.get("day_"+qstnId).value;var hour=Dom.get("hour_"+qstnId).value;var min=Dom.get("min_"+qstnId).value;var ampm=Dom.get("ampm_"+qstnId).value;var local=Dom.get("local_"+qstnId);if(el.id.indexOf("hour_")!=-1||el.id.indexOf("min_")!=-1||el.id.indexOf("ampm_")!=-1){if(el.value==null||el.value==""){KD.utils.Action.setDateTimeFields(qstnId,null,false,true);return;}}if(el.value==null||el.value==""){KD.utils.Action.setDateTimeFields(qstnId,null,true);return;}var tempHr=0;if(hour&&hour!=""){tempHr=parseInt(hour,10);if(tempHr<12&&ampm==="PM"){tempHr+=12;}if(tempHr>=12&&ampm!=="PM"){tempHr-=12;}}var parts=[yr,month,day];parts[parts.length]=tempHr;parts[parts.length]=min||0;parts[parts.length]=0;KD.utils.Action.setDateTimeFields(qstnId,parts,false,false);};this.setDateFields=function(labelId,dateArr,nullThis){var qstn=KD.utils.Util.getElementObject(labelId,"SRVQSTN_");if(!qstn){alert("function setDateFields - Unable to locate any input elements for :"+labelId);return;}var qstnId=qstn.id.slice("SRVQSTN_".length);var hour=Dom.get("hour_"+qstnId);if(hour){KD.utils.Action.setDateTimeFields(labelId,dateArr,nullThis);return;}var originalValue=qstn.value;var yr=Dom.get("year_"+qstnId);var month=Dom.get("month_"+qstnId);var day=Dom.get("day_"+qstnId);var local=Dom.get("local_"+qstnId);
var date;if(qstn){if(nullThis){qstn.value="";yr.value="";month.selectedIndex=null;day.selectedIndex=null;if(local){local.value="";}if(originalValue&&originalValue!=""){KD.utils.Action._fireChange(qstn);}return;}if(!dateArr){if(qstn.value&&qstn.value!=""&&qstn.value.indexOf("-")!=-1){dateArr=qstn.value.split("-");}else{if(month.options[0].value=="01"){date=new Date();dateArr=new Array();dateArr[0]=date.getFullYear();dateArr[1]=date.getMonth()+1;dateArr[2]=date.getDate();}else{return;}}}else{if(dateArr.length<3){date=new Date();dateArr=new Array();dateArr[0]=date.getFullYear();dateArr[1]=date.getMonth()+1;dateArr[2]=date.getDate();}}yr.value=dateArr[0];month.value=KD.utils.Util.padZeros(dateArr[1],2);day.value=KD.utils.Util.padZeros(dateArr[2],2);qstn.value=KD.utils.Util.formatDate(dateArr);if(local){local.value=KD.utils.Util.formatLocalDate(dateArr);}if(originalValue!=qstn.value&&clientManager.isLoading==false){KD.utils.Action._fireChange(qstn);}}};this.setDateTimeFields=function(labelId,localDateArr,nullThis,nullTime){var qstn=KD.utils.Util.getElementObject(labelId,"SRVQSTN_");if(!qstn){alert("function setDateTimeFields - Unable to locate any input elements for :"+labelId);return;}var qstnId=qstn.id.slice("SRVQSTN_".length);var originalValue=qstn.value;var yr=Dom.get("year_"+qstnId);var month=Dom.get("month_"+qstnId);var day=Dom.get("day_"+qstnId);var hour=Dom.get("hour_"+qstnId);var min=Dom.get("min_"+qstnId);var sec="00";var ampm=Dom.get("ampm_"+qstnId);var local=Dom.get("local_"+qstnId);var timeArr;var ampmValue="AM";var date;var utcDateArr;var parts;if(qstn){if(nullThis){qstn.value="";yr.value="";month.selectedIndex=null;day.selectedIndex=null;hour.selectedIndex=null;min.selectedIndex=null;sec="";ampm.selectedIndex=null;if(local){local.value="";}if(originalValue&&originalValue!=""){KD.utils.Action._fireChange(qstn);}return;}if(nullTime){hour.selectedIndex=null;min.selectedIndex=null;sec="";ampm.selectedIndex=null;if(qstn.value!=null&&qstn.value!=""){if(qstn.getAttribute("required")=="true"){parts=[yr.value,month.value,day.value];}else{parts=[yr.value,month.value,day.value,0,0,0];}qstn.value=KD.utils.Util.formatUTCDateTime(parts);if(local){local.value=KD.utils.Util.formatLocalDateTime(parts);}}if(originalValue&&originalValue!=""){KD.utils.Action._fireChange(qstn);}return;}if(localDateArr&&localDateArr.length>=3){if(ampm.value!=""){ampmValue=ampm.value;}timeArr=new Array();if(hour.value!=""){timeArr[0]=hour.value;if(hour.value<12&&ampmValue=="PM"){timeArr[0]=parseInt(timeArr[0],10)+12;}if(hour.value==12&&ampmValue=="AM"){timeArr[0]=0;}}else{timeArr[0]=0;}if(min.value!=""){timeArr[1]=min.value;}else{timeArr[1]=0;}if(sec!=""){timeArr[2]=sec;}else{timeArr[2]=0;}var nH=parseInt(localDateArr[3],10);localDateArr[3]=isNaN(nH)?timeArr[0]:nH;var nM=parseInt(localDateArr[4],10);localDateArr[4]=isNaN(nM)?timeArr[1]:nM;var nS=parseInt(localDateArr[5],10);localDateArr[5]=isNaN(nS)?sec:nS;}else{if(!localDateArr){if(qstn.value&&qstn.value!=""&&qstn.value.indexOf("-")!=-1&&qstn.value.indexOf(":")!=-1){utcDateArr=KD.utils.Util.parseDtString(qstn.value);date=new Date();date.setUTCFullYear(utcDateArr[0]);date.setUTCMonth(utcDateArr[1]-1);date.setUTCDate(utcDateArr[2]);date.setUTCHours(utcDateArr[3]);date.setUTCMinutes(utcDateArr[4]);date.setUTCSeconds(utcDateArr[5]);localDateArr=KD.utils.Util.getDtParts(date);}else{if(month.options[0].value=="01"){date=new Date();date.setSeconds(0);date.setMilliseconds(0);localDateArr=KD.utils.Util.getDtParts(date);}else{return;}}}else{if(localDateArr.length<3){date=new Date();date.setSeconds(0);date.setMilliseconds(0);localDateArr=KD.utils.Util.getDtParts(date);}}}ampmValue=parseInt(localDateArr[3],10)>=12?"PM":"AM";localDateArr[6]=ampmValue;var displayHr=parseInt(localDateArr[3],10);if(displayHr>12){displayHr-=12;}if(displayHr==0){displayHr=12;}yr.value=localDateArr[0];month.value=KD.utils.Util.padZeros(localDateArr[1],2);day.value=KD.utils.Util.padZeros(localDateArr[2],2);hour.value=KD.utils.Util.padZeros(displayHr,2);min.value=KD.utils.Util.padZeros(localDateArr[4],2);sec=KD.utils.Util.padZeros(localDateArr[5],2);ampm.value=localDateArr[6];qstn.value=KD.utils.Util.formatUTCDateTime(localDateArr);if(local){local.value=KD.utils.Util.formatLocalDateTime(localDateArr);}if(originalValue!=qstn.value&&clientManager.isLoading==false){KD.utils.Action._fireChange(qstn);}}};this.getRequestValue=function(record,name){if(record){var fields=record.getElementsByTagName("field");for(var i=0;i<fields.length;i++){if(fields[i].getAttribute("id")==name){if(fields[i].childNodes.length>0){return fields[i].firstChild.nodeValue;}else{return"";}}}}return"";};this._iterActionCall=function(nodeRef,fn){for(var j=0;j<nodeRef.childNodes.length;j++){var thisNode=nodeRef.childNodes[j];if((thisNode.id)&&(KD.utils.Util.getElementType(thisNode.id))=="Question"){var questionId=KD.utils.Util.getIDPart(thisNode.id);fn.call(KD.utils.Action,questionId);}else{if(thisNode.nodeName=="DIV"){KD.utils.Action._iterActionCall(thisNode,fn);}}}};this._standardActionCall=function(evt,clientAction,fn){clientAction.currEvent=KD.utils.Util.cloneObj(evt);var obj=YAHOO.util.Event.getTarget(evt);var valid=true;if(clientAction.ifExpr){var expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(valid){var fields=clientAction.params;for(var i=0;i<fields.length;i++){fn.call(KD.utils.Action,fields[i]);}}};this._makeReadOnly=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.setReadOnly);};this._makeReadWrite=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.setReadWrite);};this._hideInPlace=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.hideElementInPlace);};this._showInPlace=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.showElementInPlace);};this._insert=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.insertElement);
};this._remove=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.removeElement);};this._makeRequired=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.makeQuestionRequired);};this._makeOptional=function(evt,clientAction){KD.utils.Action._standardActionCall(evt,clientAction,KD.utils.Action.makeQuestionOptional);};this._setFieldValues=function(evt,clientAction){var obj,valid,expr,qualParams,rqtParamString,connection;clientAction.currEvent=KD.utils.Util.cloneObj(evt);obj=YAHOO.util.Event.getTarget(evt);if(clientManager.submitType!=="ReviewRequest"){clientAction.currEvent=KD.utils.Util.cloneObj(evt);valid=true;if(clientAction.ifExpr){expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(valid){qualParams=clientAction.params[0];rqtParamString=KD.utils.Action._buildParamString(qualParams);if(clientAction.source=="bridge"){KD.utils.Action.makeAsyncBridgeRequest("Set Fields - External",clientAction.actionId,rqtParamString,{success:KD.utils.Action._setFieldsCallback,failure:function(response){var message=response.getResponseHeader["X-Error-Message"];if(message==null){message="There was a problem executing a set fields event.";}KD.utils.Action.displayError(message,response);},argument:[clientAction]});}else{connection=new KD.utils.Callback(KD.utils.Action._setFieldsCallback,KD.utils.Action._setFieldsCallback,clientAction);KD.utils.Action.makeAsyncRequest("setFieldValues",clientAction.actionId,connection,rqtParamString,"",!clientAction.useGetEntry,clientAction.synchronous);}}}};this._buildParamString=function(qualParams){var rqtParamString="",len=0,thisParam,label,value,i;if(qualParams){len=qualParams.length;}if(len>0){for(i=0;i<len;i++){thisParam=qualParams[i];if(thisParam){label=thisParam.split(";")[1];value="";if(thisParam.indexOf(";BASE</FLD>")>0){value=eval(label);rqtParamString+="&"+encodeURIComponent(label)+"="+encodeURIComponent(value);}else{if(thisParam.indexOf(";ANSWER</FLD>")>0){value=KD.utils.Action.getQuestionValue(label);rqtParamString+="&"+encodeURIComponent(label)+"="+encodeURIComponent(value);}}}}}return rqtParamString;};this._setFieldsCallback=function(o,recordIndex){var recordXML,clientAction=o.argument[0],records=KD.utils.Action.getMultipleRequestRecords(o),fMap,setFields,fireChange,setToNull,alertNoMatch,alertMsg,fireChangeArr,qstn,id,action,i,j,field,value,elements,bridgeAttributeValues,attributePattern,match;action=eval("("+clientAction.params[1]+")");if(records==null||records.length==0){if(action){setToNull=action.nullOnNoMatch;alertNoMatch=action.alertOnNoMatch;alertMsg=action.alertMsg;recordXML="";}if(alertNoMatch){if(alertMsg==null||alertMsg.length==0){alertMsg="No records matched the input value.";}alert(alertMsg);}if(!setToNull){KD.utils.ClientManager.onSetFieldsReturn.fire(clientAction);return;}}if(records.length>1&&recordIndex==null){recordXML=KD.utils.Action._openSelectionDialog(o);return;}if(records.length>1&&recordIndex){recordXML=records[recordIndex];}else{recordXML=recordXML||records[0];}if(action){setFields=action.SetFields;fireChangeArr=[];bridgeAttributeValues=null;for(i=0;i<setFields.length;i++){for(field in setFields[i]){if(typeof setFields[i][field]==="string"){KD.utils.Action._handleSetReplace(field,setFields[i][field],recordXML);}else{fMap=setFields[i][field][field];fireChange=setFields[i][field]["fire"];if(clientAction.source==="bridge"){if(bridgeAttributeValues==null){bridgeAttributeValues={};if(recordXML!=null){elements=recordXML.getElementsByTagName("field");for(j=0;j<elements.length;j+=1){value=elements[j].textContent?elements[j].textContent:elements[j].text;bridgeAttributeValues[elements[j].getAttribute("id")]=value;}}}attributePattern=/<%=\s*attribute\["(.+?)"\]\s*%>/;value=fMap;match=attributePattern.exec(value);while(match!=null){value=value.replace(match[0],bridgeAttributeValues[match[1]]);match=attributePattern.exec(value);}fMap=value;}KD.utils.Action._handleSetReplace(field,fMap,recordXML,setToNull);if(fireChange==="true"){fireChangeArr.push(field);}if(fireChange==="immediate"){qstn=KD.utils.Util.getQuestionInput(field);if(qstn){KD.utils.Action._fireChange(qstn);}}}}}for(i=0;i<fireChangeArr.length;i++){id=fireChangeArr[i];qstn=KD.utils.Util.getQuestionInput(id);if(qstn){KD.utils.Action._fireChange(qstn);}}}KD.utils.ClientManager.onSetFieldsReturn.fire(clientAction);};this._openCalendarPicker=function(evt,id,calEl,cal){var theQuestion=KD.utils.Util.getQuestionInput(id);var topPos=0;var clickXY=Dom.getXY(YAHOO.util.Event.getTarget(evt));if(clickXY[1]-150>0){topPos=clickXY[1]-150;}var leftPos=clickXY[0]+25;if(leftPos+150>document.body.offsetWidth){leftPos=document.body.offsetWidth-150;}calEl.style.position="absolute";calEl.style.top=parseInt(topPos)+"px";calEl.style.left=parseInt(leftPos)+"px";var months=Dom.get("month_"+id).options;var months2=new Array();var offset=months.length-12;for(var i=offset;i<months.length;i++){months2[i-offset]=months[i].text;}if(theQuestion.value&&theQuestion.value!=""){var theDate=new Date();var parts=KD.utils.Util.parseDtString(theQuestion.value);if(parts.length>0){theDate.setYear(parts[0]);theDate.setMonth(parts[1]-1);theDate.setDate(parts[2]);cal.setYear(theDate.getFullYear());cal.setMonth(theDate.getMonth());}if(parts.length>3){theDate.setHours(parts[3]);theDate.setMinutes(parts[4]);theDate.setSeconds(parts[5]);cal.setHour(theDate.getHours());cal.setMinute(theDate.getMinutes());cal.setSecond(theDate.getSeconds());}cal.select(theDate);}cal.cfg.setProperty("HIDE_BLANK_WEEKS",true);cal.cfg.setProperty("MONTHS_LONG",months2);cal.cfg.setProperty("close",true);cal.selectEvent.subscribe(KD.utils.Action.dateSelected,[id,cal]);cal.render();cal.show();};this._openSelectionDialog=function(o){var recordXMLArray=KD.utils.Action.getMultipleRequestRecords(o),clientAction=o.argument[0],useAdvanced=true,classSuffix="",resultsTable,action,setFields;action=eval("("+clientAction.params[1]+")");if(action){setFields=action.SetFields;
if(setFields&&setFields.length){try{for(var field in setFields[0]){if(typeof setFields[0][field]==="string"){useAdvanced=false;}break;}}catch(e){}}if(useAdvanced){classSuffix="Adv";resultsTable=KD.utils.Action.showResultsAsAdvancedTable(recordXMLArray,setFields,clientAction.source);}else{resultsTable=KD.utils.Action.showResultsAsTable(recordXMLArray);}resultsTable.className+=" resultsTable"+classSuffix;var elementType=KD.utils.Util.getElementType(clientAction.elObj.id);var cfg={modal:true,draggable:false};if(elementType&&elementType.toUpperCase()!="PAGE"){cfg.context=[clientAction.elObj,"tl","bl"];}if(elementType&&elementType.toUpperCase()=="PAGE"){cfg.xy=[50,10];}var myDialogId="selectionLayer_"+clientAction.actionId;var myDialog=new YAHOO.widget.Panel(myDialogId,cfg);var recRows=KD.utils.Util.getElementsByClassName("record","tr",resultsTable);for(var r=0;r<recRows.length;r++){YAHOO.util.Event.addListener(recRows[r],"click",KD.utils.Action._selectItem,[o,r,myDialog]);YAHOO.util.Event.addListener(recRows[r],"mouseover",KD.utils.Action._mouseItem,[true]);YAHOO.util.Event.addListener(recRows[r],"mouseout",KD.utils.Action._mouseItem,[false]);}clientAction.elObj.blur();myDialog.setBody("<div class='multItemsHeader"+classSuffix+"'>Multiple Items Found (select one):</div>");if(resultsTable.offsetWidth<225){resultsTable.style.width="225px";}myDialog.appendToBody(resultsTable);myDialog.render(document.body);try{myDialog.focus();}catch(e){}var dlgWidth=(resultsTable.offsetWidth/Dom.getClientWidth());if(dlgWidth>0.6){myDialog.body.style.overflow="auto";myDialog.body.style.width=String(Dom.getClientWidth()/2)+"px";}}};this._mouseItem=function(evt,args){var isMouseOver=args[0];var thisEl=YAHOO.util.Event.getTarget(evt);if(thisEl.nodeName=="TD"){thisEl=thisEl.parentNode;}if(thisEl.nodeName=="DIV"){thisEl=thisEl.parentNode.parentNode;}if(isMouseOver){thisEl.setAttribute("previousClass",thisEl.className);thisEl.className="resultsTableHover";}else{var prevCls=thisEl.getAttribute("previousClass");if(prevCls!=null){thisEl.className=prevCls;}}};this._selectItem=function(type,args){var myDialog=args[2];myDialog.hide();if(args[0]!=null&&args[1]!=null){KD.utils.Action._setFieldsCallback(args[0],args[1]);}myDialog.destroy();};this._setInternalFieldValues=function(evt,clientAction){var obj,valid,expr,action,setFields,i,field;clientAction.currEvent=KD.utils.Util.cloneObj(evt);obj=YAHOO.util.Event.getTarget(evt);if(clientManager.submitType!=="ReviewRequest"){valid=true;clientAction.currEvent=KD.utils.Util.cloneObj(evt);if(clientAction.ifExpr){expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(valid){try{action=eval("("+clientAction.params[1]+")");}catch(err){alert(err.description);}if(action){setFields=action.SetFields;var fireChangeArr=[];for(i=0;i<setFields.length;i+=1){for(field in setFields[i]){if(typeof setFields[i][field]==="string"){KD.utils.Action._handleSetReplace(field,setFields[i][field]);}else{var fMap=setFields[i][field][field];var fireChange=setFields[i][field]["fire"];KD.utils.Action._handleSetReplace(field,fMap);if(fireChange==="true"){fireChangeArr.push(field);}}}}for(i=0;i<fireChangeArr.length;i++){var id=fireChangeArr[i];var qstn=KD.utils.Util.getQuestionInput(id);if(qstn){KD.utils.Action._fireChange(qstn);}}}}}};this._attachMenu=function(evt,clientAction){var obj,valid,expr,action,attachMenu,selectObj,val,option,qualParams,rqtParamString,connection;clientAction.currEvent=KD.utils.Util.cloneObj(evt);obj=YAHOO.util.Event.getTarget(evt);valid=true;if(clientAction.ifExpr){expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(clientManager.submitType==="ReviewRequest"){action=eval("("+clientAction.params[1]+")");if(action){attachMenu=action.AttachMenu[0];selectObj=KD.utils.Util.getQuestionInput(attachMenu.AttachTo);if(selectObj){val=selectObj.getAttribute("originalValue");if(val&&val!="null"){option=document.createElement("option");option.text=val;option.value=val;try{selectObj.add(option,null);}catch(ex){selectObj.add(option);}try{selectObj.options[selectObj.length-1].setAttribute("selected","true");selectObj.value=selectObj.options[selectObj.length-1].value;}catch(ex1){}}}}valid=false;}if(valid){qualParams=clientAction.params[0];rqtParamString=KD.utils.Action._buildParamString(qualParams);if(clientAction.source=="bridge"){KD.utils.Action.makeAsyncBridgeRequest("Populate Menu",clientAction.actionId,rqtParamString,{success:KD.utils.Action._attachMenuCallback,failure:function(response){var message=response.getResponseHeader["X-Error-Message"];if(message==null){message="There was a problem executing a set fields event.";}KD.utils.Action.displayError(message,response);},argument:[clientAction]});}else{connection=new KD.utils.Callback(KD.utils.Action._attachMenuCallback,KD.utils.Action._attachMenuCallback,clientAction);clientAction.isOnLoad=clientManager.isLoading;KD.utils.Action.makeAsyncRequest("attachMenu",clientAction.actionId,connection,rqtParamString,"",!clientAction.useGetEntry,true);}}};this._attachMenuCallback=function(o){var clientAction=o.argument[0];var recordsXML=KD.utils.Action.getMultipleRequestRecords(o);if(recordsXML){var action=eval("("+clientAction.params[1]+")");if(action){var attachMenu=action.AttachMenu[0];var optionValueField,optionTextField;if(clientAction.source=="bridge"){optionValueField=attachMenu.ValueField;optionTextField=attachMenu.LabelField;}else{var oOptionValue=attachMenu.ValueField.split(";");optionValueField=oOptionValue[1];var oOptionLabel=attachMenu.LabelField.split(";");optionTextField=oOptionLabel[1];}var targetList=KD.utils.Util.getQuestionInput(attachMenu.AttachTo);for(var h=targetList.options.length-1;h>=0;h--){targetList.remove(h);}var blankOption=document.createElement("option");blankOption.setAttribute("value","");targetList.appendChild(blankOption);targetList.style.width="1";var uniqueValueHash=new KD.utils.Hash();for(var i=0;i<recordsXML.length;i++){var optionValue=KD.utils.Util._escapeSpecialChars(KD.utils.Action.getRequestValue(recordsXML[i],optionValueField));
var optionText=KD.utils.Action.getRequestValue(recordsXML[i],optionTextField);var checkExists=uniqueValueHash.getItem(optionValue+"--"+optionText);if(checkExists==null){var newOption=document.createElement("option");newOption.setAttribute("value",optionValue);newOption.appendChild(document.createTextNode(optionText));targetList.appendChild(newOption);uniqueValueHash.setItem(optionValue+"--"+optionText,optionValue);}}targetList.style.width="auto";targetList.setAttribute("menuAttached","true");}KD.utils.Action.setQuestionValue(attachMenu.AttachTo,targetList.getAttribute("originalValue"));}KD.utils.ClientManager.onAttachMenu.fire(clientAction);};this._handleSetReplace=function(destElId,rawValue,recordXML,setToNull){var value="";if(setToNull){value="$NULL$";}else{var flds=rawValue.split("</FLD>");for(var i=0;i<flds.length;i++){if(flds[i].indexOf("<FLD>")==-1){value+=flds[i];}else{var segs=flds[i].split("<FLD>");if(segs.length>1){value+=segs[0];}if(recordXML){var fieldName=(flds[i].split(";")[0]).substring(flds[i].indexOf("<FLD>")+5);value+=KD.utils.Action.getRequestValue(recordXML,fieldName);}else{var instId=flds[i].split(";")[1];value+=KD.utils.Action.getQuestionValue(instId);}}}}value=value.replace(/__&#39;__/gi,"'");KD.utils.Action.setQuestionValue(destElId,KD.utils.Util.trimString(value));};this._addInnerHTML=function(o){var elId=o.argument[0];if(elId&&elId.length){elId=elId[0];}var el=Dom.get(elId);if(el){if(o.responseText&&o.responseText.indexOf("<errorMessage>")!=-1&&o.responseText.indexOf("invalid session")!=-1){var yes=confirm("Your session has timed out.  Would you like to reload the page?");if(yes){window.location.reload(true);}}var htmlString=o.responseText;el.innerHTML=htmlString;}};this._fireChange=function(el){if(el.dispatchEvent){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",true,true);el.dispatchEvent(evt);}else{el.fireEvent("onchange");}};this._customAction=function(evt,clientAction){clientAction.currEvent=KD.utils.Util.cloneObj(evt);if(evt){var obj=YAHOO.util.Event.getTarget(evt);}var valid=true;try{if(clientAction.ifExpr){var expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(valid){return eval(clientAction.params[0]);}}catch(error){alert("There was an error with the custom javascript:"+error);}};this._setFileLink=function(qstnEl){var link=Dom.get(qstnEl.getAttribute("id")+"_link");if(link){var qstn=link.parentNode;qstn.removeChild(link);}if(qstnEl.value&&qstnEl.value!=""){link=document.createElement("a");link.setAttribute("id",qstnEl.getAttribute("id")+"_link");link.setAttribute("target","_blank");var sessionId=encodeURIComponent(KD.utils.ClientManager.sessionId);var now=new Date();var questionId=encodeURIComponent(KD.utils.Util.getIDPart(qstnEl.getAttribute("id")));var path="SimpleDataRequest?requestName=getFile&dataRequestId=attachment&sessionId="+sessionId+"&questionId="+questionId+"&noCache="+now.getTime()+"&fileName="+encodeURIComponent(qstnEl.value);link.setAttribute("href",path);link.className="fileLink";link.style.marginRight="20px";var fileName=document.createTextNode(qstnEl.value);link.appendChild(fileName);qstnEl.originalDisplay=qstnEl.style.display;qstnEl.style.display="none";var qstnLyr=qstnEl.parentNode;var first=qstnLyr.firstChild;qstnLyr.insertBefore(link,first);}else{if(!qstnEl.originalDisplay||!qstnEl.originalDisplay==""){qstnEl.originalDisplay="inline";}qstnEl.style.display=qstnEl.originalDisplay;}};this.submissionLock=function(csrv,options){options=KD.utils.Action._buildSubmissionLockOptions(options,"lock");KD.utils.Action._doSubmissionLockAction(csrv,options);};this.submissionUnlock=function(csrv,options){options=KD.utils.Action._buildSubmissionLockOptions(options,"unlock");KD.utils.Action._doSubmissionLockAction(csrv,options);};this.isSubmissionLocked=function(csrv,options){options=KD.utils.Action._buildSubmissionLockOptions(options,"isLocked");KD.utils.Action._doSubmissionLockAction(csrv,options);};this.isSubmissionLockedByMe=function(csrv,options){options=KD.utils.Action._buildSubmissionLockOptions(options,"isLockedByMe");KD.utils.Action._doSubmissionLockAction(csrv,options);};this._submissionLock=function(evt,clientAction){KD.utils.Action._submissionLockUnlockCheck(evt,clientAction);};this._submissionUnlock=function(evt,clientAction){KD.utils.Action._submissionLockUnlockCheck(evt,clientAction);};this._buildSubmissionLockOptions=function(options,action){if(typeof options==="string"){KD.utils.Action.validateJsonLoaded();options=YAHOO.lang.JSON.parse(options);}options=options||{};if(action){options.action=action;}return options;};this._submissionLockUnlockCheck=function(evt,clientAction){clientAction.currEvent=KD.utils.Util.cloneObj(evt);var expr,options,valid=true;if(clientAction.ifExpr){expr=KD.utils.Util.trimString(clientAction.ifExpr);if(expr!=""){valid=eval("("+expr+")");}}if(valid){options=KD.utils.Action._buildSubmissionLockOptions(clientAction.params[0]);KD.utils.Action._doSubmissionLockAction(clientManager.customerSurveyId,options);}};this._removeSubmitButtons=function(){var i=0,buttons=KD.utils.Util.getElementsByClassName("templateButtonLayer","div","pageQuestionsForm");KD.utils.Action._disableButtonEvents();for(i=0;i<buttons.length;i+=1){buttons[i].parentNode.removeChild(buttons[i]);}};this._disableButtonEvents=function(e){var buttons=KD.utils.ClientManager.submitButtons,buttonDiv,buttonEls,theButton;KD.utils.ClientManager.buttonListeners={};for(var i=0;i<buttons.length;i+=1){buttonDiv=Dom.get("BUTTON_"+buttons[i]);buttonEls=KD.utils.Util.getElementsByClassName("templateButton","input",buttonDiv);if(buttonEls&&buttonEls.length>0){theButton=buttonEls[0];YAHOO.util.Event.removeListener(theButton,"click");}}};this._enableButtonEvents=function(e){var buttons=KD.utils.ClientManager.submitButtons,buttonDiv,buttonEls,theButton;for(var i=0;i<buttons.length;i+=1){buttonDiv=Dom.get("BUTTON_"+buttons[i]);buttonEls=KD.utils.Util.getElementsByClassName("templateButton","input",buttonDiv);if(buttonEls&&buttonEls.length>0){theButton=buttonEls[0];
YAHOO.util.Event.addListener(theButton,"click",KD.utils.Action._submitButtonClick,[theButton.form,KD.utils.Util.getIDPart(buttonDiv.id)],true);}}KD.utils.ClientManager.buttonListeners={};};this._submitButtonClick=function(e,parms){if(KD.utils.ClientManager.isSubmitting!=true){var theForm=parms[0];var id=parms[1];KD.utils.ClientManager.isSubmitting=true;KD.utils.Action.disableButton(id);KD.utils.Action.validateForm(e,theForm);}};this._setFieldsEventHandler=function(origAction,clientAction,origEvent){if(origAction.elementId==clientAction.elementId){clientAction.action.apply(KD.utils.Action,[origEvent,clientAction]);}else{return;}};this._attachMenuEventHandler=function(origAction,clientAction,origEvent){var theEl=eval("("+origAction.params[1]+")");if(theEl&&theEl.AttachMenu&&theEl.AttachMenu[0].AttachTo==clientAction.elementId){clientAction.action.apply(KD.utils.Action,[origEvent,clientAction]);}};this._customEventHandler=function(type,origItems,clientAction){var origAction=origItems[0];if(!origAction){return;}var origEvent=origAction.currEvent;if(!origEvent){var theTarget=KD.utils.Util.getQuestionInput(origAction.elementId);origEvent={button:0,which:1,target:theTarget,type:origAction.jsEvent};}if(type=="onSetFieldsReturn"){KD.utils.Action._setFieldsEventHandler(origAction,clientAction,origEvent);}else{if(type=="onAttachMenu"){KD.utils.Action._attachMenuEventHandler(origAction,clientAction,origEvent);}}};this._createSyncXhr=function(){var obj={},oXhr=null,oAX=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];try{oXhr=new XMLHttpRequest();}catch(e){for(var i=0;i<oAX.length;i+=1){try{oXhr=new ActiveXObject(oAX[i]);break;}catch(e2){}}}obj.xhr=oXhr;return obj;};this._buildSyncResponse=function(xhr,callbackArg){var oRes={},oHeader={},headerStr,header,delimitPos;try{headerStr=xhr.getAllResponseHeaders();header=headerStr.split("\n");for(var i=0;i<header.length;i++){delimitPos=header[i].indexOf(":");if(delimitPos!=-1){oHeader[header[i].substring(0,delimitPos)]=header[i].substring(delimitPos+2);}}}catch(e){}oRes.status=xhr.status;oRes.statusText=xhr.statusText;oRes.getResponseHeader=oHeader;oRes.getAllResponseHeaders=headerStr;oRes.responseText=xhr.responseText;oRes.responseXML=xhr.responseXML;if(typeof callbackArg!="undefined"){oRes.argument=callbackArg;}return oRes;};this.handleHttpErrorCode=function(statusCode,message){if(statusCode==401){KD.utils.ClientManager.renderSimpleLogin();}else{if(statusCode==0){alert("The web server hasn't responded in a reasonable amount of time.\nPlease try the request again.");}else{alert("Error: "+statusCode+"\n\n"+message);}}};this._doSubmissionLockAction=function(csrv,cfg){var configObj={action:"lock",responseFormat:"json",url:"SubmissionLock",timeout:10000,confirm:false,confirmMsg:"Are you sure?",nullCsrvMsg:"A submission id is required",authErrorMsg:"User is not authenticated"};for(var property in cfg){configObj[property]=cfg[property];}if(csrv===""){window.alert(configObj.nullCsrvMsg);return;}if(configObj.confirm===false||window.confirm(configObj.confirmMsg)){var AsyncRequest={success:function(o){var el;if(YAHOO.lang.isArray(o.argument)){el=YAHOO.util.Dom.get(o.argument[0]);}else{el=YAHOO.util.Dom.get(o.argument);}if(el){KD.utils.Action.validateJsonLoaded();var response=YAHOO.lang.JSON.parse(o.responseText);if(response.responseCode==="200"){KD.utils.Util.addClass(el,"responseOK");KD.utils.Util.removeClass(el,"responseError");}else{KD.utils.Util.addClass(el,"responseError");KD.utils.Util.removeClass(el,"responseOK");}el.innerHTML=response.responseMessage;}return o.responseText;},failure:function(o){this.success(o);},start:function(callback){var responseFormat=configObj.responseFormat.toLowerCase()==="xml"?"application/xml":"application/json";var parameters="csrv="+encodeURIComponent(csrv);parameters+="&action="+encodeURIComponent(configObj.action);parameters+="&nocache="+new Date().getTime();YAHOO.util.Connect.initHeader("Accept",responseFormat,true);YAHOO.util.Connect.initHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");YAHOO.util.Connect.asyncRequest("POST",configObj.url,callback,parameters);}};var callback={success:window[configObj.success]||AsyncRequest.success,failure:window[configObj.failure]||AsyncRequest.failure,scope:configObj.success?((configObj.scope)?configObj.scope:window):AsyncRequest,argument:configObj.argument||"message",timeout:configObj.timeout||10000,cache:false};AsyncRequest.start(callback);}};};}if(!KD.utils.FileLoader){KD.utils.FileLoader=new function(){this.questionObj=null;this.questionId=null;this.enforceFileTypes=false;this.fileTypesAllowed=null;this.sizeLimit=null;this.contextPath=null;this.loadFileWindow=null;this._getCenterWinFeatures=function(a,g){var c=window.screen.availWidth;var f=window.screen.availHeight;var e=parseInt(c/2)-(a/2);var d=parseInt(f/2)-(g/2);var b=",width="+a+",height="+g;b+=",top="+d+",left="+e;return b;};this.loadFile=function(a){if(!a){alert("Must include a question object");return false;}this.questionId=a.id.substring(a.id.indexOf("_")+1,a.id.length);this.questionObj=KD.utils.Util.getQuestionInput(this.questionId);if(KD.utils.Util.isArray(this.questionObj)){var b,c,e=this.questionObj.length;for(b=0;b<e;b++){c=this.questionObj[b].getAttribute("type");if(c&&c.toUpperCase()=="TEXT"){this.questionObj=this.questionObj[b];break;}}}if(this.questionObj.getAttribute("enforceFileTypes").toUpperCase()=="ENFORCE"){this.enforceFileTypes=true;}this.fileTypesAllowed=this.questionObj.getAttribute("fileTypesAllowed");this.sizeLimit=this.questionObj.getAttribute("sizeLimit");this.contextPath=KD.utils.ClientManager.webAppContextPath;var d=this._getCenterWinFeatures(500,200);var f=this.contextPath+"/resources/uploadFile.html";if(this.loadFileWindow&&!this.loadFileWindow.closed&&this.loadFileWindow.location){this.loadFileWindow.location.href=f;}else{this.loadFileWindow=window.open(f,"_blank",d);if(!this.loadFileWindow.opener){this.loadFileWindow.opener=self;}}if(window.focus){this.loadFileWindow.focus();
}};this.clearFile=function(d){this.questionID=d.id.substring(d.id.indexOf("_")+1,d.id.length);this.questionObj=KD.utils.Util.getQuestionInput(this.questionID);if(KD.utils.Util.isArray(this.questionObj)){var a,b,c=this.questionObj.length;for(a=0;a<c;a++){b=this.questionObj[a].getAttribute("type");if(b&&b.toUpperCase()=="TEXT"){this.questionObj=this.questionObj[a];break;}}}this.questionObj.value="";KD.utils.Action._setFileLink(this.questionObj);};};}if(!KD.utils.Callback){KD.utils.Callback=function(a,c,b,d){this.success=a;this.error=c;this.argument=new Array(b);this.includeLoadingImage=false;if(d){this.includeLoadingImage=d;}};}(function(){YAHOO.namespace("KD.widget");YAHOO.KD.widget.CalendarPicker=function(g,i,e){var l,f,t=e||"d",q="cal_"+i,s="calendarPanel_"+i;if(!l){function b(v){var u,d=null;if(f.getSelectedDates().length>0){u=f.getSelectedDates()[0];}else{u=null;}if(u instanceof Date){d=KD.utils.Util.getDtParts(u);}KD.utils.Action.dateSelected(v,d,[i]);l.hide();}function h(){l.hide();}function o(){f.deselectAll();f.render();}function c(){var u=f.getSelectedDates();var d;if(u.length>0){d=u[0];}else{d=f.today;}f.cfg.setProperty("pagedate",d);f.render();}var n={visible:false,context:[YAHOO.util.Event.getTarget(g),"tl","bl"],buttons:[{text:"Save",handler:b,isDefault:true},{text:"Cancel",handler:h}],draggable:false,close:true};var a=Dom.get("month_"+i);var k=a.options[0].value==""?true:false;if(k){n.buttons.push({text:"Clear",handler:o});}l=new YAHOO.widget.Dialog(i,n);l.setHeader(KD.utils.Util.getQuestionLabelValue(i));l.setBody('<div id="'+s+'"></div>');l.render(KD.utils.Util.getElementObject(i,"QLAYER_"));l.showEvent.subscribe(function(){if(YAHOO.env.ua.ie){l.fireEvent("changeContent");}});}if(!f){var r={iframe:false,hide_blank_weeks:true,close:false};if(t=="dt"){f=new YAHOO.KD.widget.Calendar(q,s,r);}else{f=new YAHOO.widget.Calendar(q,s,r);}f.renderEvent.subscribe(function(){l.fireEvent("changeContent");});f.render();}var p,m=KD.utils.Action.getQuestionValue(i);if(m!=null&&m.length>0){if(t=="dt"){p=KD.utils.Util.utcFromLocal(m);}else{var j=m.split("-");p=new Date(j[0],j[1]-1,j[2]);}}else{if(t=="dt"){p=KD.utils.Util.utcFromLocal(new Date());p.setMinutes(0);p.setSeconds(0);}else{p=new Date();}}f.cfg.setProperty("pagedate",p);f.select(p);f.render();l.show();};YAHOO.KD.widget.Calendar=function(c,a,b){YAHOO.KD.widget.Calendar.prototype.hourEl=null;YAHOO.KD.widget.Calendar.prototype.minuteEl=null;YAHOO.KD.widget.Calendar.prototype.secondEl=null;YAHOO.KD.widget.Calendar.prototype.ampmEl=null;YAHOO.KD.widget.Calendar.prototype.time=[0,0,0];YAHOO.KD.widget.Calendar.superclass.constructor.call(this,c,a,b);YAHOO.KD.widget.Calendar.prototype.renderBody=function(e,d){YAHOO.KD.widget.Calendar.superclass.renderBody.call(this,e,d);d[d.length]="<tbody>";d[d.length]="<center>";d[d.length]='<table id="time_'+this.id+'" border="0" cellpadding="0" cellspacing="2" width="182px">';d[d.length]="<tbody>";d[d.length]='<tr class="cal_time">';d[d.length]='<td align="center"><input class="dt_hr_input" style="width:22px" name="hours" type="text" maxlength="2" size="1"></input></td>';d[d.length]='<td align="center">:</td>';d[d.length]='<td align="center"><input class="dt_min_input" style="width:22px" name="minutes" type="text" maxlength="2" size="1"></input></td>';d[d.length]='<td align="center">:</td>';d[d.length]='<td align="center"><input class="dt_sec_input" style="width:22px" name="seconds" type="text" maxlength="2" size="1"></input></td>';d[d.length]='<td align="center"><select class="dt_ampm_select" style="position:relative;">'+this.ampmOpts()+"</select></td>";d[d.length]="</tr>";d[d.length]="</tbody>";d[d.length]="</table>";d[d.length]="</center>";d[d.length]="</tbody>";return d;};YAHOO.KD.widget.Calendar.prototype.applyListeners=function(){YAHOO.KD.widget.Calendar.superclass.applyListeners.call(this);var n=this.getSelectedDates();var l=12,d=0,k=0,g="AM";if(n.length>0){var f=n[0];var j=f.getHours();if(j>12){l=j-12;g="PM";}else{if(j==12){l=j;g="PM";}else{if(j==0){l=12;}else{l=j;}}}d=f.getMinutes();k=f.getSeconds();}this.hourEl=YAHOO.util.Dom.getElementsByClassName("dt_hr_input","input",this.oDomContainer)[0];this.minuteEl=YAHOO.util.Dom.getElementsByClassName("dt_min_input","input",this.oDomContainer)[0];this.secondEl=YAHOO.util.Dom.getElementsByClassName("dt_sec_input","input",this.oDomContainer)[0];this.ampmEl=YAHOO.util.Dom.getElementsByClassName("dt_ampm_select","select",this.oDomContainer)[0];YAHOO.util.Event.addListener(this.hourEl,"change",this.setHoursListener,this,true);YAHOO.util.Event.addListener(this.minuteEl,"change",this.setMinutesListener,this,true);YAHOO.util.Event.addListener(this.secondEl,"change",this.setSecondsListener,this,true);YAHOO.util.Event.addListener(this.ampmEl,"change",this.setAmPmListener,this,true);this.hourEl.value=l;this.minuteEl.value=this.padZero(d,2);this.secondEl.value=this.padZero(k,2);for(var e=0;e<this.ampmEl.options.length;e+=1){if(this.ampmEl.options[e].text==g){this.ampmEl.selectedIndex=e;break;}}this.setHour(l);this.setMinute(d);this.setSecond(k);};YAHOO.KD.widget.Calendar.prototype.ampmOpts=function(){var d=[];d[d.length]='<option value="AM">AM</option>';d[d.length]='<option value="PM">PM</option>';return d.join();};YAHOO.KD.widget.Calendar.prototype.setHoursListener=function(d,f){var e=YAHOO.util.Event.getTarget(d);if(e){f.setHour(e.value);}};YAHOO.KD.widget.Calendar.prototype.setMinutesListener=function(d,f){var e=YAHOO.util.Event.getTarget(d);if(e){f.setMinute(e.value);}};YAHOO.KD.widget.Calendar.prototype.setSecondsListener=function(d,f){var e=YAHOO.util.Event.getTarget(d);if(e){f.setSecond(e.value);}};YAHOO.KD.widget.Calendar.prototype.setAmPmListener=function(d,f){var e=YAHOO.util.Event.getTarget(d);if(e){f.setAmPm(e.value);}};YAHOO.KD.widget.Calendar.prototype.setHour=function(d){var f=parseInt(d,10);if(isNaN(f)){return;}if(f<1||f>12){return;}var g=YAHOO.util.Dom.getElementsByClassName("dt_ampm_select","select",this.oDomContainer)[0];if(g==null){return;}var e=g.value;
if(e=="PM"){f+=12;if(f==24){f=12;}}else{if(f==12){f=0;}}this.time[0]=f;if(this.getSelectedDates().length>0){this.cfg.config.selected.value[0][3]=f;}};YAHOO.KD.widget.Calendar.prototype.setMinute=function(e){var d=parseInt(e,10);if(isNaN(d)){return;}if(d<0||d>59){return;}this.time[1]=d;if(this.getSelectedDates().length>0){this.cfg.config.selected.value[0][4]=d;}};YAHOO.KD.widget.Calendar.prototype.setSecond=function(d){var e=parseInt(d,10);if(isNaN(e)){return;}if(e<0||e>59){return;}this.time[2]=e;if(this.getSelectedDates().length>0){this.cfg.config.selected.value[0][5]=e;}};YAHOO.KD.widget.Calendar.prototype.setAmPm=function(d){var e="AM";if(d=="AM"||d=="PM"){e=d;}var g=YAHOO.util.Dom.getElementsByClassName("dt_hr_input","input",this.oDomContainer)[0];if(g==null){return;}var f=parseInt(g.value,10);if(isNaN(f)){return;}if(f<1||f>12){return;}if(e=="PM"){f+=12;if(f==24){f=12;}}else{if(f==12){f=0;}}this.time[0]=f;this.cfg.config.selected.value[0][3]=f;};YAHOO.KD.widget.Calendar.prototype.padZero=function(d,f){f=f||2;if(d!=null&&d!=undefined&&d.toString().length<f){for(var e=0;e<f-d.toString().length;e+=1){d="0"+d;}}return d;};YAHOO.KD.widget.Calendar.prototype._toDate=function(f){if(f instanceof Date){return f;}else{if(f&&f.length==3){return new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5]);}else{if(f){var e=new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5]);var d=KD.utils.Util.localFromUTC(e);return d;}}}};YAHOO.KD.widget.Calendar.prototype._toFieldArray=function(f){var e=[];if(f instanceof Date){e=[[f.getFullYear(),f.getMonth()+1,f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds()]];}else{if(YAHOO.lang.isString(f)){e=this._parseDates(f);}else{if(YAHOO.lang.isArray(f)){for(var g=0;g<f.length;++g){var h=f[g];e[e.length]=[h.getFullYear(),h.getMonth()+1,h.getDate(),h.getHours(),h.getMinutes(),h.getSeconds()];}}}}return e;};YAHOO.KD.widget.Calendar.prototype.getSelectedDates=function(){var g=[];var f=this.cfg.getProperty(YAHOO.widget.Calendar._DEFAULT_CONFIG.SELECTED.key);for(var i=0;i<f.length;++i){var h=f[i];var e=new Date(h[0],h[1]-1,h[2],h[3],h[4],h[5]);g.push(e);}g.sort(function(j,d){return j-d;});return g;};YAHOO.KD.widget.Calendar.prototype.selectCell=function(g){var e=this.cells[g];var k=this.cellDates[g];var j=this._toDate(k);var f=YAHOO.util.Dom.hasClass(e,this.Style.CSS_CELL_SELECTABLE);if(f){this.beforeSelectEvent.fire();var i=YAHOO.widget.Calendar._DEFAULT_CONFIG.SELECTED.key;var h=this.cfg.getProperty(i);var d=k.concat();d[d.length]=this.time[0];d[d.length]=this.time[1];d[d.length]=this.time[2];if(this._indexOfSelectedFieldArray(d)==-1){h[h.length]=d;}if(this.parent){this.parent.cfg.setProperty(i,h);}else{this.cfg.setProperty(i,h);}this.renderCellStyleSelected(j,e);this.selectEvent.fire([d]);this.doCellMouseOut.call(e,null,this);}return this.getSelectedDates();};YAHOO.KD.widget.Calendar.prototype.select=function(i){var j,k,f,e=[],h=[];f=KD.utils.Util.localFromUTC(i);k=this.cfg.config.selected.key;j=this._toFieldArray(f);this.cfg.setProperty(YAHOO.widget.Calendar.DEFAULT_CONFIG.PAGEDATE.key,f);for(var d=0;d<j.length;++d){var g=j[d];if(!this.isDateOOB(this._toDate(g))){if(e.length===0){this.beforeSelectEvent.fire();h=this.cfg.getProperty(k);}e.push(g);if(this._indexOfSelectedFieldArray(g)==-1){h[h.length]=g;}}}if(e.length>0){if(this.parent){this.parent.cfg.setProperty(k,h);}else{this.cfg.setProperty(k,h);}this.selectEvent.fire(e);}return this.getSelectedDates();};};YAHOO.lang.extend(YAHOO.KD.widget.Calendar,YAHOO.widget.Calendar);})();